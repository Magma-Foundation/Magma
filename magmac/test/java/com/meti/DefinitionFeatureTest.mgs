extern import { Test } from org.junit.jupiter.api;
extern import { ParameterizedTest } from org.junit.jupiter.params;
extern import { ValueSource } from org.junit.jupiter.params.provider;
extern import { assertCompile } from com.meti.CompiledTest;
extern import com.meti.Compiler;
extern import { TEST_SYMBOL } from com.meti.FeatureTest;
extern import { renderJavaClass } from com.meti.JavaLang;

export object DefinitionFeatureTest = {
	pub const TEST_VALUE : String = "100";
}

export class def DefinitionFeatureTest() => {
	DeclarationNodeBuilder : () => Void;
	@ParameterizedTest
	@ValueSource(strings = ["first", "second"])
	def testSimpleDefinition() : Void => {
        FeatureTest.assertWithinClass(DEFAULT_BUILDER
                .setName(name)
                .build()
                .render(), new MagmaDefinitionBuilder().setFlagString("").setMutabilityString(LET_KEYWORD).setName(name).setType(I32).setValue("0").createMagmaDefinition().render());
    }
	@ParameterizedTest
	@ValueSource(ints = [2, 3])
	def testMultipleDefinitions() : Void => {
        FeatureTest.assertWithinClass(DEFAULT_BUILDER.build().render().repeat(count),
                new MagmaDefinitionBuilder().setFlagString("").setMutabilityString(LET_KEYWORD).setName(TEST_SYMBOL).setType(I32).setValue("0").createMagmaDefinition().render().repeat(count));
    }
	@Test
	def testType() : Void => {
        FeatureTest.assertWithinClass(DEFAULT_BUILDER
                .setType(LONG)
                .build()
                .render(), new MagmaDefinitionBuilder().setFlagString("").setMutabilityString(LET_KEYWORD).setName(TEST_SYMBOL).setType(I64).setValue("0").createMagmaDefinition().render());
    }
	@Test
	def testValue() : Void => {
        FeatureTest.assertWithinClass(DEFAULT_BUILDER
                .withValue(TEST_VALUE)
                .build()
                .render(), new MagmaDefinitionBuilder().setFlagString("").setMutabilityString(LET_KEYWORD).setName(TEST_SYMBOL).setType(I32).setValue(TEST_VALUE).createMagmaDefinition().render());
    }
	@Test
	def testFinal() : Void => {
        FeatureTest.assertWithinClass(DEFAULT_BUILDER
                .withFlagString(FINAL_KEYWORD + " ")
                .withValue(TEST_VALUE)
                .build()
                .render(), new MagmaDefinitionBuilder().setFlagString("").setMutabilityString(CONST_KEYWORD).setName(TEST_SYMBOL).setType(I32).setValue(TEST_VALUE).createMagmaDefinition().render());
    }
	@ParameterizedTest
	@ValueSource(strings = [TEST_SYMBOL, TEST_SYMBOL + "_more"])
	def testStatic() : Void => {
        String content = new MagmaDefinitionBuilder().setFlagString("").setMutabilityString(LET_KEYWORD).setName(TEST_SYMBOL).setType(I32).setValue(TEST_VALUE).createMagmaDefinition().render();
        assertCompile(renderJavaClass(className, DEFAULT_BUILDER
                        .withValue(TEST_VALUE)
                        .withFlagString("static ")
                        .build()
                        .render()),
                new ObjectNode("", className, content).renderObject()
                + "\n\n"
                + new MagmaClassNodeBuilder().setPrefix("").setName(className).setContent("").createMagmaClassNode().render());
    }
	@Test
	def testPublic() : Void => {
        FeatureTest.assertWithinClass(DEFAULT_BUILDER.withFlagString("public ")
                        .withValue(TEST_VALUE)
                        .build()
                        .render(),
                new MagmaDefinitionBuilder().setFlagString("pub ").setMutabilityString(LET_KEYWORD).setName(TEST_SYMBOL).setType(I32).setValue(TEST_VALUE).createMagmaDefinition().render());
    }
}